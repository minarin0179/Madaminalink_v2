# ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

Madaminalinkã®ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆã¨ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹æ§‹é€ ã‚’è§£èª¬ã—ã¾ã™ã€‚

## ğŸ“‹ ç›®æ¬¡

- [æ¦‚è¦](#æ¦‚è¦)
- [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
- [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ](#ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ )
- [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³](#ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³)
- [ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼](#ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼)
- [ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ](#ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ)
- [æ‹¡å¼µæ€§](#æ‹¡å¼µæ€§)

---

## æ¦‚è¦

Madaminalinkã¯ã€Discord.jsã‚’åŸºç›¤ã¨ã—ãŸ**ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼å‹Discord Bot**ã§ã™ã€‚ä»¥ä¸‹ã®è¨­è¨ˆåŸå‰‡ã«åŸºã¥ã„ã¦ã„ã¾ã™ï¼š

### è¨­è¨ˆåŸå‰‡

1. **ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒªãƒ†ã‚£** - ã‚³ãƒãƒ³ãƒ‰ã¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç‹¬ç«‹ã—ãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦ç®¡ç†
2. **æ‹¡å¼µæ€§** - æ–°æ©Ÿèƒ½ã‚’ç°¡å˜ã«è¿½åŠ ã§ãã‚‹ä»•çµ„ã¿
3. **å‹å®‰å…¨æ€§** - TypeScriptã«ã‚ˆã‚‹å³æ ¼ãªå‹ãƒã‚§ãƒƒã‚¯
4. **è²¬ä»»ã®åˆ†é›¢** - ã‚³ãƒãƒ³ãƒ‰ã€ã‚¤ãƒ™ãƒ³ãƒˆã€UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æ˜ç¢ºã«åˆ†é›¢
5. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹** - Bunãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã«ã‚ˆã‚‹é«˜é€Ÿå®Ÿè¡Œã¨ã‚·ãƒ£ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å¯¾å¿œ

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ãƒ»è¨€èª

| æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |
|------|-----------|------|
| **Bun** | Latest | ãƒ¡ã‚¤ãƒ³ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ï¼ˆé«˜é€Ÿèµ·å‹•ï¼‰ |
| **Node.js** | 16+ | äº’æ›æ€§ã®ãŸã‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ |
| **TypeScript** | 5.1.6 | å‹å®‰å…¨ãªé–‹ç™º |

### ã‚³ã‚¢ä¾å­˜é–¢ä¿‚

| ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |
|-----------|-----------|------|
| **discord.js** | 14.14.1 | Discord API ãƒ©ãƒƒãƒ‘ãƒ¼ |
| **mongoose** | 8.4.4 | MongoDB ODMï¼ˆæŠ•ç¥¨ãƒ‡ãƒ¼ã‚¿ï¼‰ |
| **mongodb** | 4.10.0 | ãƒã‚¤ãƒ†ã‚£ãƒ–MongoDBãƒ‰ãƒ©ã‚¤ãƒ |
| **agenda** | 4.3.0 | ã‚¸ãƒ§ãƒ–ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ï¼ˆãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ï¼‰ |
| **dotenv** | 16.0.2 | ç’°å¢ƒå¤‰æ•°ç®¡ç† |
| **pm2** | 5.2.2 | ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç† |

### é–‹ç™ºãƒ„ãƒ¼ãƒ«

- **ESLint** - ã‚³ãƒ¼ãƒ‰å“è³ªç®¡ç†
- **Prettier** - ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
- **TypeScript ESLint** - TypeScriptå¯¾å¿œã®ãƒªãƒ³ã‚¿ãƒ¼

---

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
/home/user/Madaminalink_v2/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ commands/                 # ã‚³ãƒãƒ³ãƒ‰å®šç¾©
â”‚   â”‚   â”œâ”€â”€ slashcommands/       # ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰ï¼ˆ18ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ setup.ts         # ã‚²ãƒ¼ãƒ ç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
â”‚   â”‚   â”‚   â”œâ”€â”€ archive.ts       # ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–æ©Ÿèƒ½
â”‚   â”‚   â”‚   â”œâ”€â”€ copy.ts          # ãƒãƒ£ãƒ³ãƒãƒ«ã‚³ãƒ”ãƒ¼
â”‚   â”‚   â”‚   â”œâ”€â”€ delete.ts        # ä¸€æ‹¬å‰Šé™¤
â”‚   â”‚   â”‚   â”œâ”€â”€ poll.ts          # æŠ•ç¥¨æ©Ÿèƒ½
â”‚   â”‚   â”‚   â””â”€â”€ ...              # ãã®ä»–ã®ã‚³ãƒãƒ³ãƒ‰
â”‚   â”‚   â””â”€â”€ contextmenu/         # ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆ6ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â”‚       â”œâ”€â”€ editMessage.ts   # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç·¨é›†
â”‚   â”‚       â”œâ”€â”€ deleteBefore.ts  # å‰å‰Šé™¤
â”‚   â”‚       â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ components/              # ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ buttons/            # ãƒœã‚¿ãƒ³ãƒãƒ³ãƒ‰ãƒ©ï¼ˆ13ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ poll.ts         # æŠ•ç¥¨ãƒœã‚¿ãƒ³
â”‚   â”‚   â”‚   â”œâ”€â”€ diceroll.ts     # ãƒ€ã‚¤ã‚¹ãƒ­ãƒ¼ãƒ«
â”‚   â”‚   â”‚   â”œâ”€â”€ roleAdd.ts      # ãƒ­ãƒ¼ãƒ«ä»˜ä¸
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ selectmenu/         # ã‚»ãƒ¬ã‚¯ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆ3ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ roleList.ts     # ãƒ­ãƒ¼ãƒ«é¸æŠ
â”‚   â”‚   â”‚   â””â”€â”€ transferList.ts # è»¢é€å…ˆé¸æŠ
â”‚   â”‚   â””â”€â”€ modal/              # ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆ1ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â”‚       â””â”€â”€ editModal.ts    # ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ 
â”‚   â”‚
â”‚   â”œâ”€â”€ events/                  # Discordã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©
â”‚   â”‚   â”œâ”€â”€ interactionCreate.ts # ãƒ¡ã‚¤ãƒ³ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒãƒ£ãƒ¼
â”‚   â”‚   â”œâ”€â”€ ready.ts            # Botèµ·å‹•æ™‚
â”‚   â”‚   â””â”€â”€ guildCreate.ts      # ã‚µãƒ¼ãƒãƒ¼å‚åŠ æ™‚
â”‚   â”‚
â”‚   â”œâ”€â”€ structures/              # ã‚¯ãƒ©ã‚¹å®šç¾©ãƒ»å‹å®šç¾©
â”‚   â”‚   â”œâ”€â”€ Client.ts           # æ‹¡å¼µDiscordã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ SlashCommand.ts     # ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰åŸºåº•ã‚¯ãƒ©ã‚¹
â”‚   â”‚   â”œâ”€â”€ Button.ts           # ãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåŸºåº•ã‚¯ãƒ©ã‚¹
â”‚   â”‚   â”œâ”€â”€ Modal.ts            # ãƒ¢ãƒ¼ãƒ€ãƒ«åŸºåº•ã‚¯ãƒ©ã‚¹
â”‚   â”‚   â”œâ”€â”€ SelectMenu.ts       # ã‚»ãƒ¬ã‚¯ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼åŸºåº•ã‚¯ãƒ©ã‚¹
â”‚   â”‚   â”œâ”€â”€ ContextMenu.ts      # ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼åŸºåº•ã‚¯ãƒ©ã‚¹
â”‚   â”‚   â”œâ”€â”€ Events.ts           # ã‚¤ãƒ™ãƒ³ãƒˆåŸºåº•ã‚¯ãƒ©ã‚¹
â”‚   â”‚   â”œâ”€â”€ Poll.ts             # æŠ•ç¥¨ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ï¼ˆMongooseï¼‰
â”‚   â”‚   â””â”€â”€ ChannelLink.ts      # ãƒãƒ£ãƒ³ãƒãƒ«ãƒªãƒ³ã‚¯å‹å®šç¾©
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                   # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
â”‚   â”‚   â”œâ”€â”€ Reply.ts            # çµ±ä¸€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒãƒ³ãƒ‰ãƒ©
â”‚   â”‚   â”œâ”€â”€ FetchAllMessages.ts # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¨ä»¶å–å¾—
â”‚   â”‚   â”œâ”€â”€ transferMessage.ts  # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è»¢é€
â”‚   â”‚   â”œâ”€â”€ ButtonToRow.ts      # ãƒœã‚¿ãƒ³â†’ActionRowå¤‰æ›
â”‚   â”‚   â”œâ”€â”€ DeleteMultiMessages.ts # ä¸€æ‹¬å‰Šé™¤
â”‚   â”‚   â”œâ”€â”€ SplitMessage.ts     # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸åˆ†å‰²
â”‚   â”‚   â””â”€â”€ ...                 # ãã®ä»–ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼
â”‚   â”‚
â”‚   â”œâ”€â”€ constants/               # å®šæ•°å®šç¾©
â”‚   â”‚   â””â”€â”€ MyConstants.ts      # ã‚·ã‚¹ãƒ†ãƒ å®šæ•°
â”‚   â”‚
â”‚   â”œâ”€â”€ bot.ts                   # ãƒ¡ã‚¤ãƒ³ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ–
â”‚   â”œâ”€â”€ index.ts                 # ã‚·ãƒ£ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ï¼ˆã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆï¼‰
â”‚   â””â”€â”€ agenda.ts                # Agendaã‚¸ãƒ§ãƒ–è¨­å®š
â”‚
â”œâ”€â”€ dist/                        # TypeScriptãƒ“ãƒ«ãƒ‰å‡ºåŠ›
â”œâ”€â”€ .db/                         # MongoDBãƒ‡ãƒ¼ã‚¿ï¼ˆDockerãƒœãƒªãƒ¥ãƒ¼ãƒ ï¼‰
â”‚
â”œâ”€â”€ Configuration Files
â”‚   â”œâ”€â”€ tsconfig.json           # TypeScriptè¨­å®š
â”‚   â”œâ”€â”€ package.json            # ä¾å­˜é–¢ä¿‚ãƒ»ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”œâ”€â”€ .eslintrc.json         # ESLintè¨­å®š
â”‚   â”œâ”€â”€ Dockerfile             # Dockerè¨­å®š
â”‚   â”œâ”€â”€ docker-compose.yml     # ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ Madaminalink_pm2.config.js # PM2è¨­å®š
â”‚   â””â”€â”€ .env.sample            # ç’°å¢ƒå¤‰æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”‚
â””â”€â”€ README.md                   # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆèª¬æ˜
```

**ç·ã‚³ãƒ¼ãƒ‰é‡:** ç´„3,442è¡Œã®TypeScript

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³

### 1. ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å‹•çš„ãƒ­ãƒ¼ãƒ‰ã‚·ã‚¹ãƒ†ãƒ 

`Client.ts` ãŒä¸­æ ¸ã‚’æ‹…ã†ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ­ãƒ¼ãƒ€ãƒ¼ï¼š

```typescript
// ç–‘ä¼¼ã‚³ãƒ¼ãƒ‰
class Client extends DiscordClient {
    commands: Collection<string, Command>
    components: Collection<string, Component>

    async loadModules() {
        // src/commands/slashcommands/*.ts ã‚’è‡ªå‹•æ¤œå‡º
        const commandFiles = await scanDirectory('./commands')
        for (const file of commandFiles) {
            const command = await import(file)
            this.commands.set(command.name, command)
        }

        // åŒæ§˜ã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã‚¤ãƒ™ãƒ³ãƒˆã‚‚ãƒ­ãƒ¼ãƒ‰
    }
}
```

**åˆ©ç‚¹:**
- æ–°ã—ã„ã‚³ãƒãƒ³ãƒ‰ã‚’è¿½åŠ ã™ã‚‹éš›ã€å˜ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®ã™ã‚‹ã ã‘ã§è‡ªå‹•èªè­˜
- ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰å¯¾å¿œã®åŸºç›¤
- ãƒ†ã‚¹ãƒˆæ™‚ã«ç‰¹å®šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã¿ã‚’ãƒ­ãƒ¼ãƒ‰å¯èƒ½

---

### 2. ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒãƒ‘ã‚¿ãƒ¼ãƒ³

`events/interactionCreate.ts` ãŒå…¨ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼š

```typescript
// ç–‘ä¼¼ã‚³ãƒ¼ãƒ‰
async function handleInteraction(interaction) {
    if (interaction.isCommand()) {
        // ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰ or ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼
        const command = client.commands.get(interaction.commandName)
        await command.run(interaction)
    }
    else if (interaction.isButton()) {
        // customIdå½¢å¼: "componentName;arg1;arg2"
        const [name, ...args] = interaction.customId.split(';')
        const component = client.components.get(name)
        await component.run(interaction, ...args)
    }
    else if (interaction.isSelectMenu()) { /* åŒæ§˜ */ }
    else if (interaction.isModalSubmit()) { /* åŒæ§˜ */ }
}
```

**ã‚«ã‚¹ã‚¿ãƒ IDè¦ç´„:**
- åŒºåˆ‡ã‚Šæ–‡å­—: `;` ï¼ˆãƒ¡ã‚¤ãƒ³ï¼‰ã€`:` ï¼ˆã‚µãƒ–ï¼‰ã€`,` ï¼ˆé…åˆ—ï¼‰
- ä¾‹: `poll;vote;characterA` â†’ `poll` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€`vote` ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€`characterA` å¼•æ•°

---

### 3. ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Discord UI Layer                  â”‚  â† ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³
â”‚   (Buttons, Menus, Modals)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Interaction Dispatcher            â”‚  â† ã‚¤ãƒ™ãƒ³ãƒˆãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
â”‚   (interactionCreate.ts)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Command/Component Layer           â”‚  â† ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â”‚   (Commands, Buttons, Menus)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Utility Layer                     â”‚  â† å…±é€šå‡¦ç†
â”‚   (Reply, FetchMessages, etc.)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Data Layer                        â”‚  â† ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–
â”‚   (MongoDB, Discord API)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 4. ã‚·ãƒ£ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æˆ¦ç•¥

`index.ts` ãŒã‚·ãƒ£ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã¨ã—ã¦æ©Ÿèƒ½ï¼š

```typescript
// ç–‘ä¼¼ã‚³ãƒ¼ãƒ‰
const manager = new ShardingManager('./bot.ts', {
    totalShards: 'auto',  // Discordæ¨å¥¨ã‚·ãƒ£ãƒ¼ãƒ‰æ•°ã‚’è‡ªå‹•è¨ˆç®—
    mode: 'process',      // ãƒ—ãƒ­ã‚»ã‚¹ãƒ¢ãƒ¼ãƒ‰ï¼ˆã‚ˆã‚Šå …ç‰¢ï¼‰
    respawn: true         // ã‚¯ãƒ©ãƒƒã‚·ãƒ¥æ™‚ã®è‡ªå‹•å†èµ·å‹•
})

manager.spawn()
```

**ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°:**
- 2,500ã‚µãƒ¼ãƒãƒ¼ã”ã¨ã«1ã‚·ãƒ£ãƒ¼ãƒ‰ï¼ˆDiscordä»•æ§˜ï¼‰
- å„ã‚·ãƒ£ãƒ¼ãƒ‰ã¯ç‹¬ç«‹ã—ãŸãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦å®Ÿè¡Œ
- ãƒ—ãƒ­ã‚»ã‚¹é–“é€šä¿¡ã§ãƒ‡ãƒ¼ã‚¿å…±æœ‰

---

## ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### 1. ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œãƒ•ãƒ­ãƒ¼

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼: /poll title:æŠ•ç¥¨ choices:A,B,C
    â†“
Discord Gateway â†’ interactionCreate ã‚¤ãƒ™ãƒ³ãƒˆ
    â†“
Dispatcher: commandName="poll" ã‚’æ¤œå‡º
    â†“
poll.ts ã® run() ãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè¡Œ
    â†“
    â”œâ”€â†’ MongoDB ã«æŠ•ç¥¨ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
    â”œâ”€â†’ ButtonToRow ã§ãƒœã‚¿ãƒ³ã‚’ç”Ÿæˆ
    â””â”€â†’ Reply.reply() ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
    â†“
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æŠ•ç¥¨UIã‚’è¡¨ç¤º
```

---

### 2. ãƒœã‚¿ãƒ³ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ãƒ•ãƒ­ãƒ¼

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼: ã€ŒAã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
    â†“
Discord: customId="poll;vote;A;pollId123"
    â†“
Dispatcher: "poll" ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æ¤œå‡º
    â†“
components/buttons/poll.ts ã® run()
    â†“
    â”œâ”€â†’ MongoDB ã‹ã‚‰æŠ•ç¥¨ãƒ‡ãƒ¼ã‚¿å–å¾—
    â”œâ”€â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æŠ•ç¥¨çŠ¶æ…‹ã‚’ç¢ºèª
    â”œâ”€â†’ æŠ•ç¥¨ã‚’è¨˜éŒ²ãƒ»æ›´æ–°
    â””â”€â†’ Reply.update() ã§çµæœã‚’æ›´æ–°
    â†“
ã€ŒæŠ•ç¥¨ã—ã¾ã—ãŸ: Aã€ã¨è¡¨ç¤º
```

---

### 3. ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–å‡¦ç†ãƒ•ãƒ­ãƒ¼

```
/archive target:categoryId
    â†“
archive.ts ã® run()
    â†“
ã‚«ãƒ†ã‚´ãƒªå†…ã®å…¨ãƒãƒ£ãƒ³ãƒãƒ«ã‚’å–å¾—
    â†“
å„ãƒãƒ£ãƒ³ãƒãƒ«ã”ã¨ã«å‡¦ç†:
    â”œâ”€â†’ FetchAllMessages ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¨å–å¾—
    â”œâ”€â†’ ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ãƒãƒ£ãƒ³ãƒãƒ«ã«ã‚¹ãƒ¬ãƒƒãƒ‰ä½œæˆ
    â”œâ”€â†’ SplitMessage ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’2000æ–‡å­—ã”ã¨ã«åˆ†å‰²
    â”œâ”€â†’ æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆ10MBä»¥ä¸‹ï¼‰
    â””â”€â†’ ã‚¹ãƒ¬ãƒƒãƒ‰ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŠ•ç¨¿
    â†“
å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
```

---

## ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### 1. Clientï¼ˆæ‹¡å¼µDiscordã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«:** `src/structures/Client.ts`

**è²¬å‹™:**
- Discord.js ã® `Client` ã‚’æ‹¡å¼µ
- ã‚³ãƒãƒ³ãƒ‰ãƒ»ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ»ã‚¤ãƒ™ãƒ³ãƒˆã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†
- ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å‹•çš„ãƒ­ãƒ¼ãƒ‰
- MongoDBæ¥ç¶šã®åˆæœŸåŒ–

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰:**
```typescript
class Client extends DiscordClient {
    commands: Collection<string, Command>

    async loadCommands(): Promise<void>
    async loadEvents(): Promise<void>
    async loadComponents(): Promise<void>
    async connectDatabase(): Promise<void>
}
```

---

### 2. Interaction Dispatcher

**ãƒ•ã‚¡ã‚¤ãƒ«:** `src/events/interactionCreate.ts`

**è²¬å‹™:**
- å…¨ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã®å—ä¿¡
- ã‚³ãƒãƒ³ãƒ‰ãƒ»ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¸ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- å®‰å…¨æ©Ÿèƒ½ï¼ˆ24æ™‚é–“åˆ¶é™ãªã©ï¼‰

**ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°:**
```typescript
try {
    await command.run(interaction)
} catch (error) {
    if (error.code === 50013) {
        return Reply.reply(interaction, 'æ¨©é™ãŒä¸è¶³ã—ã¦ã„ã¾ã™')
    }
    // ä»–ã®Discordã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã«ã‚‚å¯¾å¿œ
}
```

---

### 3. Reply Utility

**ãƒ•ã‚¡ã‚¤ãƒ«:** `src/utils/Reply.ts`

**è²¬å‹™:**
- ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®çµ±ä¸€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- é…å»¶ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆdeferï¼‰ã®è‡ªå‹•å‡¦ç†
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ¨™æº–åŒ–

**ãƒ¡ã‚½ãƒƒãƒ‰:**
```typescript
class Reply {
    static async reply(interaction, content, ephemeral = false)
    static async update(interaction, content)
    static async followUp(interaction, content)
    static async defer(interaction, ephemeral = false)
}
```

---

### 4. FetchAllMessages Utility

**ãƒ•ã‚¡ã‚¤ãƒ«:** `src/utils/FetchAllMessages.ts`

**è²¬å‹™:**
- Discord APIã®ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã‚’å‡¦ç†
- å¤§é‡ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’åŠ¹ç‡çš„ã«å–å¾—
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®è‡ªå‹•å‡¦ç†

**å®Ÿè£…:**
```typescript
async function fetchAllMessages(channel) {
    const messages = []
    let lastId = null

    while (true) {
        const batch = await channel.messages.fetch({
            limit: 100,
            before: lastId
        })
        if (batch.size === 0) break

        messages.push(...batch.values())
        lastId = batch.last().id
    }

    return messages
}
```

---

### 5. Poll Modelï¼ˆMongoDBï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«:** `src/structures/Poll.ts`

**ã‚¹ã‚­ãƒ¼ãƒ:**
```typescript
const PollSchema = new Schema({
    messageId: String,        // æŠ•ç¥¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ID
    channelId: String,        // ãƒãƒ£ãƒ³ãƒãƒ«ID
    title: String,            // æŠ•ç¥¨ã‚¿ã‚¤ãƒˆãƒ«
    choices: [String],        // é¸æŠè‚¢
    votes: Map<String, String>, // userId -> choice
    allowChange: Boolean,     // å¤‰æ›´è¨±å¯
    showVoters: Boolean       // æŠ•ç¥¨è€…è¡¨ç¤º
})
```

---

## æ‹¡å¼µæ€§

### æ–°ã—ã„ã‚³ãƒãƒ³ãƒ‰ã®è¿½åŠ 

1. `src/commands/slashcommands/mycommand.ts` ã‚’ä½œæˆ
2. `SlashCommand` ã‚¯ãƒ©ã‚¹ã‚’ç¶™æ‰¿
3. `run()` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…

```typescript
import { SlashCommand } from '../../structures/SlashCommand'

export default class MyCommand extends SlashCommand {
    constructor() {
        super({
            name: 'mycommand',
            description: 'My new command',
            options: [/* ... */]
        })
    }

    async run(interaction) {
        // ã‚³ãƒãƒ³ãƒ‰ãƒ­ã‚¸ãƒƒã‚¯
    }
}
```

å†èµ·å‹•å¾Œã€è‡ªå‹•çš„ã« `/mycommand` ãŒä½¿ç”¨å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

---

### æ–°ã—ã„ãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®è¿½åŠ 

1. `src/components/buttons/mybutton.ts` ã‚’ä½œæˆ
2. `Button` ã‚¯ãƒ©ã‚¹ã‚’ç¶™æ‰¿
3. `customId` ã‚’è¨­å®š

```typescript
import { Button } from '../../structures/Button'

export default class MyButton extends Button {
    constructor() {
        super({ customId: 'mybutton' })
    }

    async run(interaction, arg1, arg2) {
        // ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ã®å‡¦ç†
    }
}
```

ãƒœã‚¿ãƒ³ä½œæˆæ™‚ã« `customId: 'mybutton;value1;value2'` ã‚’æŒ‡å®šã™ã‚‹ã¨ã€è‡ªå‹•çš„ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã•ã‚Œã¾ã™ã€‚

---

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 1. ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥

```typescript
// src/bot.ts
const client = new Client({
    makeCache: Options.cacheWithLimits({
        MessageManager: 100,      // æœ€æ–°100ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã¿ã‚­ãƒ£ãƒƒã‚·ãƒ¥
        GuildMemberManager: 200,  // 200ãƒ¡ãƒ³ãƒãƒ¼ã¾ã§
        // ãã®ä»–ã¯æœ€å°é™
    }),
    sweepers: {
        messages: {
            interval: 900,  // 15åˆ†ã”ã¨ã«ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
            lifetime: 1800  // 30åˆ†ä»¥ä¸Šå¤ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤
        }
    }
})
```

**ç†ç”±:**
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®å‰Šæ¸›
- å¤§è¦æ¨¡ã‚µãƒ¼ãƒãƒ¼ã§ã®å®‰å®šæ€§å‘ä¸Š

---

### 2. ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®å‡¦ç†

Discord APIã¯ä»¥ä¸‹ã®åˆ¶é™ãŒã‚ã‚Šã¾ã™ï¼š

- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡: 5ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/5ç§’
- ãƒãƒ£ãƒ³ãƒãƒ«ä½œæˆ: 50/æ—¥
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‰Šé™¤: 5ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ç§’

Madaminalinkã¯ discord.js ã®è‡ªå‹•ãƒ¬ãƒ¼ãƒˆåˆ¶é™å‡¦ç†ã‚’åˆ©ç”¨ã—ã€429ã‚¨ãƒ©ãƒ¼ã‚’å›é¿ã—ã¦ã„ã¾ã™ã€‚

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### 1. ç’°å¢ƒå¤‰æ•°ã®åˆ†é›¢

æ©Ÿå¯†æƒ…å ±ã¯ `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ï¼š

```
TOKEN=<Discord Bot Token>
MONGODB=mongodb://localhost:27017
```

`.gitignore` ã§ `.env` ã‚’é™¤å¤–ã—ã€`.env.sample` ã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã—ã¦æä¾›ã€‚

---

### 2. 24æ™‚é–“ã‚»ãƒ¼ãƒ•ãƒ†ã‚£ãƒ­ãƒƒã‚¯

```typescript
// interactionCreate.ts
const joinedAt = interaction.guild.joinedAt
const hoursSinceJoin = (Date.now() - joinedAt) / (1000 * 60 * 60)

if (hoursSinceJoin < 24 && isDangerousCommand(commandName)) {
    return Reply.reply(interaction, 'å®‰å…¨ã®ãŸã‚ã€å‚åŠ å¾Œ24æ™‚é–“ã¯å®Ÿè¡Œã§ãã¾ã›ã‚“')
}
```

ç ´å£Šçš„ã‚³ãƒãƒ³ãƒ‰ï¼ˆ`/delete`, `/cleanup`ï¼‰ã¯ã€Botå‚åŠ å¾Œ24æ™‚é–“ã¯å®Ÿè¡Œä¸å¯ã€‚

---

## ğŸ“– é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [é–‹ç™ºç’°å¢ƒæ§‹ç¯‰](./setup.md) - ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- [APIãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](./api-reference.md) - è©³ç´°ãªã‚¯ãƒ©ã‚¹ãƒ»é–¢æ•°ä»•æ§˜
- [ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¬ã‚¤ãƒ‰](./deployment.md) - æœ¬ç•ªç’°å¢ƒã¸ã®å±•é–‹
